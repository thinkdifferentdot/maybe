---
phase: 02-core-operations
plan: 01
type: execute
---

<objective>
Add anthropic gem dependency and create Provider::Anthropic class skeleton with client initialization.

Purpose: Establish the foundation for Anthropic integration by adding the gem and creating the provider class structure.

Output: Updated Gemfile with anthropic gem, Provider::Anthropic class with client initialization and basic error handling.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-operations/02-RESEARCH.md
@.planning/phases/02-core-operations/02-CONTEXT.md
@app/models/provider/openai.rb
@app/models/provider/llm_concept.rb
@app/models/provider.rb
@Gemfile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add anthropic gem to Gemfile</name>
  <files>Gemfile</files>
  <action>Add `gem "anthropic", "~> 1.16.0"` to the AI section of Gemfile (around line 92, after "ruby-openai" gem). The official gem name is "anthropic" (NOT "ruby-anthropic" - that was the old community gem that renamed itself). Use ~> 1.16.0 for version constraint as documented in RESEARCH.md.</action>
  <verify>grep 'anthropic' Gemfile shows the gem added in the AI section</verify>
  <done>anthropic gem ~> 1.16.0 added to Gemfile in AI section</done>
</task>

<task type="auto">
  <name>Task 2: Create Provider::Anthropic class skeleton</name>
  <files>app/models/provider/anthropic.rb</files>
  <action>Create Provider::Anthropic class that:
1. Inherits from Provider
2. Includes LlmConcept module (for auto_categorize, auto_detect_merchants interface)
3. Defines Error = Class.new(Provider::Error) for provider-specific errors
4. Sets DEFAULT_MODEL = "claude-sonnet-4-5-20250929" (use exact model ID format with date suffix)
5. Initializes with access_token and optional model parameter
6. Creates Anthropic::Client instance with api_key
7. Stores @default_model (fallback to DEFAULT_MODEL if not provided)

Follow the exact pattern from app/models/provider/openai.rb lines 1-28. The structure should match OpenAI's pattern but use Anthropic::Client instead of OpenAI::Client.</action>
  <verify>ruby -c app/models/provider/anthropic.rb passes, class includes Error constant and initialize method accepting access_token</verify>
  <done>Provider::Anthropic class compiles, inherits from Provider, includes LlmConcept, initializes Anthropic client</done>
</task>

<task type="auto">
  <name>Task 3: Add supports_model? and provider_name methods</name>
  <files>app/models/provider/anthropic.rb</files>
  <action>Add two query methods to Provider::Anthropic:
1. supports_model?(model) - Returns true for Claude models (claude-3-*, claude-sonnet-*, claude-haiku-*, claude-opus-*)
2. provider_name - Returns "Anthropic" (string, for display/logging)

These follow the OpenAI pattern (see lines 30-40 in openai.rb). For supports_model?, check if model starts with any supported Anthropic model prefixes.</action>
  <verify>grep -E "supports_model|provider_name" app/models/provider/anthropic.rb shows both methods defined</verify>
  <done>supports_model? checks for Claude model prefixes, provider_name returns "Anthropic"</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bundle install` succeeds without errors
- [ ] `ruby -c app/models/provider/anthropic.rb` passes syntax check
- [ ] Provider::Anthropic can be instantiated: Provider::Anthropic.new("test-key")
- [ ] No RuboCop offenses introduced
</verification>

<success_criteria>

- anthropic gem added to Gemfile
- Provider::Anthropic class created with proper inheritance
- Anthropic::Client initializes correctly
- Basic query methods (supports_model?, provider_name) implemented
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-operations/02-01-SUMMARY.md`:

# Phase 2 Plan 1: Foundation Summary

**Added anthropic gem and created Provider::Anthropic class skeleton**

## Accomplishments

- Added official anthropic gem (~> 1.16.0) to Gemfile
- Created Provider::Anthropic class inheriting from Provider with LlmConcept
- Implemented client initialization with Anthropic::Client
- Added Error subclass for provider-specific errors
- Added supports_model? and provider_name query methods

## Files Created/Modified

- `Gemfile` - Added anthropic gem dependency
- `app/models/provider/anthropic.rb` - New provider class skeleton

## Decisions Made

- DEFAULT_MODEL = "claude-sonnet-4-5-20250929" (balanced model for categorization/merchant detection)
- Used official "anthropic" gem, not "ruby-anthropic" community gem

## Issues Encountered

None

## Next Step

Ready for 02-02-PLAN.md - Implement auto_categorize method
</output>
