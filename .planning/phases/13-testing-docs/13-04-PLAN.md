---
phase: 13-testing-docs
plan: 04
type: execute
domain: rails
---

<objective>
Run full AI regression tests across all features with both OpenAI and Anthropic providers to ensure no regressions.

Purpose: Verify that all AI features (chat, auto-categorize, auto-detect merchants) still work correctly with both providers after the changes in phases 10-12. This is the final verification step before declaring Phase 13 complete.
Output: Regression test results showing all AI features work with both OpenAI and Anthropic providers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-testing-docs/13-CONTEXT.md

# Prior context from v1.0 and v1.1 phases:
@.planning/phases/08-validation-testing/08-01-SUMMARY.md
@.planning/phases/08-validation-testing/08-02-SUMMARY.md
@.planning/phases/08-validation-testing/08-03-SUMMARY.md

# Key files to reference:
@app/models/provider/openai.rb
@app/models/provider/anthropic.rb
@app/models/provider/registry.rb
@test/models/provider/openai_test.rb
@test/models/provider/anthropic_test.rb
@test/models/family/auto_categorizer_test.rb

# VCR cassettes for regression testing:
@test/vcr_cassettes/openai/
@test/vcr_cassettes/anthropic/

**Tech stack available:** Rails 7.2, Minitest, VCR for external API testing, fixtures
**Established patterns:** VCR.use_cassette for API calls, ClimateControl.modify for ENV vars, ProviderTestHelper for mocking
**Constraining decisions:**
- All AI features must work with both OpenAI and Anthropic from v1.0
- No regressions in existing AI functionality from CONTEXT.md
- Provider selection via Setting.llm_provider from 12-01

**Key decisions from prior phases:**
- Phase 8 (v1.0): Comprehensive testing established baseline for both providers
- Phase 12-01: AutoCategorizer uses family's configured LLM provider
- Phase 10-12: New trigger paths added, must not break existing features
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run OpenAI provider regression tests</name>
  <files>test/models/provider/openai_test.rb</files>
  <action>Run existing OpenAI provider tests to verify no regressions:
1. Execute: bin/rails test test/models/provider/openai_test.rb
2. Verify all tests pass (auto_categorize, auto_detect_merchants, chat_response)
3. Check for any new failures or skips
4. Document any issues found in ISSUES.md if they exist

This is the baseline verification that existing OpenAI functionality wasn't broken by phases 10-12 changes.</action>
  <verify>bin/rails test test/models/provider/openai_test.rb passes with 0 failures</verify>
  <done>OpenAI provider regression tests pass - no regressions detected</done>
</task>

<task type="auto">
  <name>Task 2: Run Anthropic provider regression tests</name>
  <files>test/models/provider/anthropic_test.rb</files>
  <action>Run existing Anthropic provider tests to verify no regressions:
1. Execute: bin/rails test test/models/provider/anthropic_test.rb
2. Verify all tests pass (auto_categorize, auto_detect_merchants, chat_response with function calls)
3. Check for any new failures or skips
4. Document any issues found in ISSUES.md if they exist

This verifies that existing Anthropic functionality wasn't broken by phases 10-12 changes.</action>
  <verify>bin/rails test test/models/provider/anthropic_test.rb passes with 0 failures</verify>
  <done>Anthropic provider regression tests pass - no regressions detected</done>
</task>

<task type="auto">
  <name>Task 3: Run AutoCategorizer integration tests with both providers</name>
  <files>test/models/family/auto_categorizer_test.rb</files>
  <action>Run AutoCategorizer tests with provider switching to verify dynamic provider selection works:
1. Execute: bin/rails test test/models/family/auto_categorizer_test.rb
2. Verify tests pass that check provider selection based on Setting.llm_provider
3. Verify confidence tracking tests pass
4. Verify learned pattern application tests pass

This tests the integration added in 12-01 for dynamic provider selection.</action>
  <verify>bin/rails test test/models/family/auto_categorizer_test.rb passes with 0 failures</verify>
  <done>AutoCategorizer integration tests pass - provider selection works correctly</done>
</task>

<task type="auto">
  <name>Task 4: Run full test suite and document results</name>
  <files>.planning/phases/13-testing-docs/13-04-REGRESSION_RESULTS.md</files>
  <action>Run complete test suite and document results:
1. Execute: bin/rails test
2. Capture final test count, assertions, failures, errors, skips
3. Compare against baseline from Phase 8 (~162 assertions expected)
4. Create 13-04-REGRESSION_RESULTS.md documenting:
   - Total test count
   - Any new tests added in Phase 13
   - Any failing tests with diagnosis
   - Overall assessment: PASS/FAIL

If any tests fail, diagnose and document the issue before proceeding. The goal is to declare Phase 13 complete only when all tests pass.</action>
  <verify>bin/rails test passes with 0 failures, 0 errors</verify>
  <done>Full test suite passes - Phase 13 regression testing complete</done>
</task>

</tasks>

<verification>
Before declaring plan (and Phase 13) complete:
- [ ] OpenAI provider tests pass (test/models/provider/openai_test.rb)
- [ ] Anthropic provider tests pass (test/models/provider/anthropic_test.rb)
- [ ] AutoCategorizer integration tests pass (test/models/family/auto_categorizer_test.rb)
- [ ] Full test suite passes (bin/rails test)
- [ ] Regression results documented in 13-04-REGRESSION_RESULTS.md
- [ ] No regressions detected in any AI features
- [ ] Both providers (OpenAI and Anthropic) work correctly
</verification>

<success_criteria>

- All OpenAI provider tests pass with no regressions
- All Anthropic provider tests pass with no regressions
- AutoCategorizer provider selection works correctly
- Full test suite passes with 0 failures
- Regression results documented showing test counts and assessment
- Phase 13 ready to declare complete
</success_criteria>

<output>
After completion, create `.planning/phases/13-testing-docs/13-04-SUMMARY.md`:

# Phase 13 Plan 4: Full AI Regression Summary

**Ran full AI regression tests across all features with both providers - no regressions detected**

## Accomplishments

- Ran OpenAI provider regression tests - all pass
- Ran Anthropic provider regression tests - all pass
- Ran AutoCategorizer integration tests with provider selection - all pass
- Ran full test suite - all pass with [N] tests, [M] assertions
- Created 13-04-REGRESSION_RESULTS.md documenting results

## Regression Results

**OpenAI Provider:** ✓ PASS (N tests, M assertions)
- auto_categorize: working
- auto_detect_merchants: working
- chat_response: working

**Anthropic Provider:** ✓ PASS (N tests, M assertions)
- auto_categorize: working
- auto_detect_merchants: working
- chat_response with function calls: working

**AutoCategorizer Integration:** ✓ PASS
- Dynamic provider selection: working
- Confidence tracking: working
- Learned pattern application: working

**Full Test Suite:** ✓ PASS
- Total tests: [N]
- Total assertions: [M]
- Failures: 0
- Errors: 0
- Skips: [K]

## Files Created/Modified

- `.planning/phases/13-testing-docs/13-04-REGRESSION_RESULTS.md` - Regression test results

## Issues Found

[None if all tests pass, otherwise document any issues]

## Phase 13 Complete

All 4 plans completed:
- 13-01: LearnedPattern Model Tests ✓
- 13-02: AI Categorization Controllers ✓
- 13-03: Settings & Confidence Integration ✓
- 13-04: Full AI Regression ✓

## Next Phase

Phase 13 complete! Milestone v1.1 (AI Auto-Categorization Triggers) is now complete with all 4 phases (10, 11, 12, 13) finished.

Ready for next milestone or feature work.
</output>
